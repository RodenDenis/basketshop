<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Hasbahçe</title>
	<link href="style.css" rel="stylesheet">
	<base href="C:\Users\Administrator\Desktop\my_site\">
</head>

<body>
	<div class="popular-and-price">
		<div class="container">
			<h2 class="section-title">Популярное/новое</h2>
			<button class="btn to-catalog" type="button" id="toShop">В каталог</button>
			<button class="btn to-cart" type="button" id="cart">Корзина</button>
			<div class="popular-items clearfix" id="shop">

				<div class="catalog-item item_box" id="goods">
					<p class="item_article">#00001</p>
					<h3 class="item_title">Розовый цветок</h3>
					<p><span class="item_price">250</span>грн</p>
					<p class="desription">Желтый бант и малый горшок</p>
				
					<button class="btn btn-buy add_item" data-id="1" >Купить</button>
				</div>

				<div class="catalog-item item_box" id="goods">
					<p class="item_article">#00002</p>
					<h3 class="item_title">Желтый цветок</h3>
					<p><span class="item_price">230</span>грн</p>
					<p class="desription">Синий бант и средний горшок</p>
				
					<button class="btn btn-buy add_item" data-id="2" >Купить</button>
				</div>

				<div class="catalog-item item_box" id="goods">
					<p class="item_article">#00003</p>
					<h3 class="item_title">Красный цветок</h3>
					<p><span class="item_price">270</span>грн</p>
					<p class="desription">Розовый бант и малый горшок</p>
				
					<button class="btn btn-buy add_item" data-id="3" >Купить</button>
				</div>

				<div class="catalog-item item_box" id="goods">
					<p class="item_article">#00004</p>
					<h3 class="item_title">Белый цветок</h3>
					<p><span class="item_price">200</span>грн</p>
					<p class="desription">Белый бант и большой горшок</p>
				
					<button class="btn btn-buy add_item" data-id="4" >Купить</button>
				</div>

			</div>

			<div id="table">
				<div id="cart_content"></div>
				<button id="checkout">Оформить заказ</button>
				<button id="clear_cart">Очистить корзину</button>
			</div>
				
			

		</div>
		
	</div>
	<script>
		document.getElementById('cart').onclick = function () {
			document.getElementById('shop').style.display = 'none';
			document.getElementById('table').style.display = '';
			document.getElementsByClassName('section-title') = 'Корзина';
		}

		document.getElementById('toShop').onclick = function () {
			document.getElementById('shop').style.display = '';
			document.getElementById('table').style.display = 'none';
			document.getElementsByClassName('section-title') = 'Популярное/новое';
		}

	
		var	itemBox = document.querySelectorAll('.item_box'); 
		var	cartCont = document.getElementById('cart_content'); 
			
			function addEvent(elem, type, handler) {
				if (elem.addEventListener) {
					elem.addEventListener(type, handler, false);
				} else {
					elem.attachEvent('on' + type, function () { handler.call(elem); });
				}
				return false;
			}
			
			function getCartData() {
				return JSON.parse(localStorage.getItem('cart'));
			}
			
			function setCartData(o) {
				localStorage.setItem('cart', JSON.stringify(o));
				return false;
			}
			
			function addToCart(e) {
				this.disabled = true; 
				var cartData = getCartData() || {}; 
				var	parentBox = this.parentNode; 
				var	itemId = this.getAttribute('data-id');
				var	itemArticle = parentBox.querySelector('.item_article').innerHTML; 
				var	itemTitle = parentBox.querySelector('.item_title').innerHTML; 
				var	itemPrice = parentBox.querySelector('.item_price').innerHTML;
				
				if (cartData.hasOwnProperty(itemId)) { 
					cartData[itemId][2] += 1;
				} else { 
					cartData[itemId] = [itemArticle, itemTitle, 1, itemPrice];
				}
				if (!setCartData(cartData)) { 
					this.disabled = false; 
				}
				return false;
			}
			
			for (var i = 0; i < itemBox.length; i++) {
				addEvent(itemBox[i].querySelector('.add_item'), 'click', addToCart);
			}
			
			function openCart(e) {
				var cartData = getCartData(); 
				var	totalItems = '';
				
				if (cartData !== null) {
					totalItems = '<table class="shopping_list"><tr><th>Артикул</th><th>Наименование</th><th>Количество</th><th>Цена за 1шт</th><th>Всего</th></tr>';
					for (var items in cartData) {
						totalItems += '<tr>';
						for (var i = 0; i < cartData[items].length; i++) {
							totalItems += '<td>' + cartData[items][i] + '</td>';
						}
						totalItems += '</tr>';
					}

					totalItems += '</table>';
					cartCont.innerHTML = totalItems;
				} else {
					cartCont.innerHTML = 'В корзине пусто!';
				}
				return false;
			}	
			addEvent(document.getElementById('checkout'), 'click', openCart);
			
			addEvent(document.getElementById('clear_cart'), 'click', function (e) {
				localStorage.removeItem('cart');
				cartCont.innerHTML = 'Корзина очишена.';
			});
	</script>
</body>

</html>